!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){let r=location.pathname;if(r.endsWith(".html")){const e=r.split("/");r=e.slice(0,e.length-1).join("/")+"/"}window.initializeServiceWorker=async function(){if("serviceWorker"in navigator){const e=navigator.serviceWorker.controller;if(e&&e.scriptURL.endsWith("/service-worker.js"))console.log("Service worker was activated.");else{navigator.serviceWorker.oncontrollerchange=function(){this.controller.onstatechange=function(){"activated"===this.state&&console.log("Service worker successfully activated.")}};const e=await navigator.serviceWorker.register("/service-worker.js");console.log("Service worker successfully registered, scope is:",e.scope),await navigator.serviceWorker.ready,navigator.serviceWorker.controller||window.location.reload()}}else console.log("Service workers are not supported.")},window.setupImJoyApp=function(){const e=window.define;window.define=void 0,loadImJoyBasicApp({version:"0.13.70",process_url_query:!0,show_window_title:!1,show_progress_bar:!0,show_empty_window:!0,menu_style:{position:"absolute",right:0,top:"2px"},window_style:{width:"100%",height:"100%"},imjoy_api:{}}).then(async e=>{const t=e.imjoy.api;function r(e){return new Promise(async(t,r)=>{const i=await fetch(e),n=await i.blob(),o=new FileReader;o.onload=function(){t(this.result)},o.onerror=r,o.readAsDataURL(n)})}await t.registerService({type:"#file-loader",name:"ITK/VTK Viewer",async check(e){if(e.mime.startsWith("image/tiff"))return!0},async load({url:e,window_id:r}){console.log("https://kitware.github.io/itk-vtk-viewer/app/?fileToLoad="+e),await t.createWindow({src:"https://kitware.github.io/itk-vtk-viewer/app/?fileToLoad="+e,window_id:r})}}),await t.registerService({type:"#file-loader",name:"Kaibu",icon:"https://kaibu.org/static/img/kaibu-icon.svg",async check(e){if(e.mime.startsWith("image/")||"directory"===e.mime)return!0},async load({source:e,type:i,window_id:n}){if("file"===i){const i=await r(e.url),o=await t.createWindow({src:"https://kaibu.org/",window_id:n,w:10,h:10});await o.view_image(i,{name:e.name}),await o.add_shapes([],{name:"annotation"})}else if("directory"===i){const i=await t.createWindow({src:"https://kaibu.org/",window_id:n,w:10,h:10}),o=(e=e.filter(e=>e.mime.startsWith("image/"))).map(e=>({title:e.name,data:e,isLeaf:!0}));await i.add_widget({_rintf:!0,type:"tree",name:"Files",node_dbclick_callback:async e=>{await i.clear_layers();const t=e.data,n=await r(t.url);await i.view_image(n,{name:t.name})},nodes:o}),await i.add_shapes([],{name:"annotation"})}}}),await t.registerService({type:"#content-provider",name:"MyData",get:e=>({name:"My Folder",path:"/user",type:"directory",created:"2021-01-23T18:25:43.511Z",last_modified:"2021-01-23T18:25:43.511Z",mimetype:null,format:"json",content:[{name:"My SubFolder",path:"/user/me",type:"directory",created:"2021-01-23T18:25:43.511Z",last_modified:"2021-01-23T18:25:43.511Z",mimetype:null}]}),save(e,t){},delete_file(e){},rename_file(e,t){},file_exists(e){},dir_exists(e){},is_hidden(e){}}),window.imjoy=e.imjoy}).finally(()=>{window.define=e})};window.elFinderSupportBrowserFs=function(e){"use strict";this.parseFiles=function(e,t,r){const i=$.Deferred();return r.done((function(r){const n=r[0].length;let o=-1;if(n){if(r[4]&&r[4].length)return void e.request({data:{cmd:"mkdir",target:t,dirs:r[4]},notify:{type:"mkdir",cnt:r[4].length},preventFail:!0}).fail((function(e){"errCmdParams"===(e=e||["errUnknown"])[0]?o=1:(o=0,i.reject(e))})).done((function(e){var i=!1;e.hashes||(e.hashes={}),r[1]=$.map(r[1],(function(n,o){return r[0][o]._relativePath=n.replace(/^\//,""),""===(n=n.replace(/\/[^\/]*$/,""))?t:e.hashes[n]?e.hashes[n]:(i=!0,r[0][o]._remove=!0,null)})),i&&(r[0]=$.grep(r[0],(function(e){return!e._remove})))})).always((function(e){i.resolve(r)}));r[1]=$.map(r[1],(function(){return t})),i.resolve(r)}else i.reject(["errUploadNoFiles"])})).fail((function(){i.reject()})),i},this.upload=function(e){const t=this.fm,r=$.Deferred(),i=e.target||t.cwd().hash,n=e.input?e.input.files:t.uploads.checkFile(e,t,i);function o(e){elfinder_api.upload(e).then(e=>{t.uploads.xhrUploading=!1,e&&(t.currentReqCmd="upload",e.warning&&console.warn(e.warning),t.updateCache(e),e.removed&&e.removed.length&&t.remove(e),e.added&&e.added.length&&t.add(e),e.changed&&e.changed.length&&t.change(e),t.trigger("upload",e,!1),t.trigger("uploaddone"),e.toasts&&Array.isArray(e.toasts)&&$.each(e.toasts,(function(){this.msg&&t.toast(this)})),e.sync&&t.sync(),e.debug&&(t.responseDebug(e),fm.debug("backend-debug",e))),r.resolve(e)}).catch(e=>{console.error(e),r.reject(e)})}return e.progress=e=>{t.notify({type:"upload",cnt:0,progress:e,size:0})},n.done?this.parseFiles(t,i,n).done(e=>{o({files:e[0],targets:e[1],renames:e[2],hashes:e[3]})}):o({targets:n.map(()=>i),files:n}),r},this.init=function(e){this.fm=e,this.fm.options.url=r+"/fs/connector"},this.send=function(e){const t=$.Deferred();t.abort=function(){};const r=function(e){e=new URLSearchParams(e);const t={};for(let r of Array.from(e.entries()))t[r[0]]?Array.isArray(t[r[0]])?t[r[0]].push(r[1]):t[r[0]]=[t[r[0]],r[1]]:r[0].endsWith("[]")?t[r[0]]=[r[1]]:t[r[0]]=r[1];return t}(e.url.split("?")[1]);r&&Object.assign(e.data,r);const i=$.ajax(e).fail((function(e){t.reject(e)})).done((function(e){t.resolve(e)}));return t.abort=function(){i&&"pending"==i.state()&&(i.quiet=!0,i.abort())},t}}}]);
//# sourceMappingURL=elFinderSupportBrowserFS.js.map