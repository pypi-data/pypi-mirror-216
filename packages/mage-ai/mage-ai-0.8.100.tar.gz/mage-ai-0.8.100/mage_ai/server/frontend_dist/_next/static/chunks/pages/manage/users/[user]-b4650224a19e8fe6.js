(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4496],{20103:function(e,r,n){"use strict";n.d(r,{L6:function(){return u},HF:function(){return s}});var t,o=n(81132);!function(e){e.MAIN="main",e.STANDALONE="standalone",e.SUB="sub"}(t||(t={}));var u,i=n(10503);function s(e,r,n){var s=e.owner,c=e.roles,a=[{Icon:i.Vz,id:u.WORKSPACES,isSelected:function(){return u.WORKSPACES===n},label:function(){return"Workspaces"},linkProps:{href:"/manage"}}];return(s||c===o.No.ADMIN)&&a.push({Icon:i.NO,id:u.USERS,isSelected:function(){return u.USERS===n},label:function(){return"Users"},linkProps:{href:"/manage/users"}}),r==t.MAIN&&a.push({Icon:i.Zr,id:u.SETTINGS,isSelected:function(){return u.SETTINGS===n},label:function(){return"Settings"},linkProps:{href:"/manage/settings"}}),a}!function(e){e.WORKSPACES="workspaces",e.USERS="users",e.SETTINGS="settings"}(u||(u={}))},3849:function(e,r,n){"use strict";var t=n(82684),o=n(1210),u=n(82531),i=n(49125),s=n(20103),c=n(9736),a=n(28598);r.Z=function(e){var r=e.before,n=e.breadcrumbs,l=void 0===n?[]:n,d=e.children,v=e.errors,f=e.pageName,p=e.subheaderChildren,m=u.ZP.statuses.list().data,b=(0,t.useMemo)((function(){var e,r;return null===m||void 0===m||null===(e=m.statuses)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.project_type}),[m]),h=(0,c.PR)()||{};return(0,a.jsx)(o.Z,{before:r,beforeWidth:r?50*i.iI:0,breadcrumbs:l,errors:v,navigationItems:(0,s.HF)(h,b,f),subheaderChildren:p,title:"Workspaces",uuid:"workspaces/index",children:d})}},82702:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return x}});var t=n(77837),o=n(38860),u=n.n(o),i=n(82684),s=n(34376),c=n(41788),a=n(86673),l=n(20582),d=n(75582),v=n(21831),f=n(82394),p=n(21764),m=n(83455),b=n(60328),h=n(55378),S=n(87815),O=n(19711),g=n(82531),w=n(24224),j=n(96510),P=n(28598);function _(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function k(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?_(Object(n),!0).forEach((function(r){(0,f.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}var Z=function(e){var r=e.fetchUser,n=e.user,t=e.workspaces,o=(0,i.useState)(),u=o[0],s=o[1];(0,i.useEffect)((function(){n&&s(n)}),[n]);var c=null===t||void 0===t?void 0:t.map((function(e){return e.project_uuid})),l=g.ZP.roles.list({entity:"project",entity_ids:c},{},{}),_=l.data,Z=(l.mutate,(0,i.useMemo)((function(){var e=(null===_||void 0===_?void 0:_.roles)||[];return null===e||void 0===e?void 0:e.reduce((function(e,r){var n=r.permissions[0].entity_id,t=e[n]||[];return k(k({},e),{},(0,f.Z)({},n,[].concat((0,v.Z)(t),[r])))}),{})}),[_])),E=(0,i.useMemo)((function(){var e=u||n,r=null===e||void 0===e?void 0:e.roles_new;return null===r||void 0===r?void 0:r.reduce((function(e,r){var n,t,o=null===r||void 0===r||null===(n=r.permissions)||void 0===n||null===(t=n[0])||void 0===t?void 0:t.entity_id;return k(k({},e),{},(0,f.Z)({},o,r))}),{})}),[u,n]),y=(0,m.Db)(g.ZP.users.useUpdate(null===n||void 0===n?void 0:n.id),{onSuccess:function(e){return(0,j.wD)(e,{callback:function(e){var n=e.user;p.Am.success("User roles successfully saved.",{position:p.Am.POSITION.BOTTOM_RIGHT,toastId:"user-update-success-".concat(n.id)}),r()},onErrorCallback:function(e){var r=e.error,n=r.errors,t=r.exception,o=r.message,u=r.type;p.Am.error((null===n||void 0===n?void 0:n.error)||t||o,{position:p.Am.POSITION.BOTTOM_RIGHT,toastId:u})}})}}),I=(0,d.Z)(y,2),N=I[0],T=I[1].isLoading;return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(S.Z,{columnFlex:[1,1],columns:[{uuid:"Workspace"},{uuid:"Role"}],rows:null===t||void 0===t?void 0:t.map((function(e){var r=e.name,n=e.project_uuid,t=(null===Z||void 0===Z?void 0:Z[n])||[],o=null===E||void 0===E?void 0:E[n];return[(0,P.jsx)(O.ZP,{bold:!0,children:r},"name"),(0,P.jsx)(h.Z,{onChange:function(e){var r=(0,w.sE)(t,(function(r){return r.id==e.target.value}));r&&s((function(e){var n,t=(null===e||void 0===e||null===(n=e.roles_new)||void 0===n?void 0:n.filter((function(e){return e.id!=(null===r||void 0===r?void 0:r.id)})))||[];console.log("prev roles:",t);var o={roles_new:[].concat((0,v.Z)(t),[r])};return k(k({},e),o)}))},placeholder:"No access",primary:!0,setContentOnMount:!0,value:null===o||void 0===o?void 0:o.id,children:t.map((function(e){var r=e.id,n=e.name;return(0,P.jsx)("option",{value:r,children:n},n)}))},"project_role")]}))}),(0,P.jsx)(a.Z,{p:2,children:(0,P.jsx)(b.Z,{loading:T,onClick:function(){var e,r=k(k({},u),{},{roles_new:null===u||void 0===u||null===(e=u.roles_new)||void 0===e?void 0:e.map((function(e){return e.id}))});N({user:r})},primary:!0,children:"Update roles"})})]})},E=n(3849),y=n(49125),I=n(63153),N=n(20103);function T(e){var r=e.user,n=(0,s.useRouter)(),t=(0,i.useState)(null),o=t[0],u=t[1],c=null===r||void 0===r?void 0:r.id,d=g.ZP.users.detail(c),v=d.data,f=d.mutate,p=(0,i.useMemo)((function(){return null===v||void 0===v?void 0:v.user}),[v]);(0,i.useEffect)((function(){(0,j.bB)(v,u)}),[v]);var m=g.ZP.workspaces.list({user_id:c},{refreshInterval:5e3,revalidateOnFocus:!0}),b=m.data,h=(m.mutate,(0,i.useMemo)((function(){return(0,P.jsx)(a.Z,{p:y.cd,children:(0,P.jsx)(l.Z,{hideFields:[I.s7],onDeleteSuccess:function(){return n.push("/manage/users")},onSaveSuccess:f,showDelete:!0,title:"Edit user",user:p})})}),[f,n,p])),S=(0,i.useMemo)((function(){return null===b||void 0===b?void 0:b.workspaces}),[b]);return(0,P.jsx)(E.Z,{before:h,breadcrumbs:[{label:function(){return"Workspaces"},linkProps:{as:"/manage",href:"/manage"}},{label:function(){return"Users"},linkProps:{as:"/manage/users",href:"/manage/users"}},{bold:!0,label:function(){return(null===p||void 0===p?void 0:p.username)||"User"}}],errors:o,pageName:N.L6.USERS,children:(0,P.jsx)(Z,{fetchUser:f,user:p,workspaces:S})})}T.getInitialProps=function(){var e=(0,t.Z)(u().mark((function e(r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.query.user,e.abrupt("return",{user:{id:n}});case 2:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();var x=(0,c.Z)(T)},11976:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/users/[user]",function(){return n(82702)}])}},function(e){e.O(0,[844,7607,1424,1005,7815,3883,9774,2888,179],(function(){return r=11976,e(e.s=r);var r}));var r=e.O();_N_E=r}]);