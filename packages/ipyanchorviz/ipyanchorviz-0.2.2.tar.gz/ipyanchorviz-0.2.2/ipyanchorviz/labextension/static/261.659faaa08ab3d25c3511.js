"use strict";(self.webpackChunkipyanchorviz=self.webpackChunkipyanchorviz||[]).push([[261],{791:(e,t,n)=>{n.r(t),n.d(t,{AnchorVizModel:()=>m,AnchorVizView:()=>A,version:()=>y.i8});var o=n(672),i=n(431),a=n(654),r=n(422);function s(e,t,n,o=!1){let i=e.model.get("radius"),a=e.model.get("margin"),r=t*Math.cos(n),s=t*Math.sin(n);return o&&(r+=i+a.left,s+=i+a.top),[r,s]}function c(e,t,n){let o=e.model.get("radius"),i=e.model.get("margin");return[t-=o+i.left,n-=o+i.top]}function l(e,t,n){[t,n]=c(e,t,n);let o=Math.atan(n/t);return t<0&&(o+=Math.PI),o}function d(e,t){for(let n=0;n<t.length;n++)if(t[n].id===e)return n;return-1}function h(e,t){return-1!==d(e.id,t)}function g(e){if(0===e.length)return-1;let t=parseInt(e[0].id);for(let n of e)parseInt(n.id)>t&&(t=parseInt(n.id));return t}function u(e){return i.cloneDeep(e.model.get("anchors"))}function f(e,t){e.model.set("anchors",i.cloneDeep(t)),e.touch(),e.localAnchors=i.cloneDeep(t)}function v(e){e.enterDatapoints(),e.animateDatapoints()}function p(e){let t,n=e.model.get("radius"),o=e.model.get("margin"),h=e.model.get("focusIndicatorActionDistance"),v=e.model.get("anchorSize");e.defaultAnchorColor="grey",e.focusIndicatorActionInRange=!1,e.focusIndicatorOverAnchor=!1,e.anchorDragging=!1,e.hoveringOverPoint=!1,e.draggingAnchorPrevTheta=0;let p=function(t){let n=e.localAnchors,o=0,i=0,a=e.model.get("radius")-e.model.get("ringInnerPadding"),r=e.model.get("autoNorm");if(void 0!==t.weights){function l(e){return void 0===e.visible||e.visible}for(let d of n)if(l(d)){if(d.id in t.weights){let h=t.weights[d.id],[g,u]=s(e,a,d.theta,!1);o+=g*h,i+=u*h}}else if(t.weights[d.id]>0){r=!0;break}if(r){o=0,i=0;let f=0;for(let v of n)l(v)&&v.id in t.weights&&(f+=t.weights[v.id]);if(f>0)for(let p of n)if(l(p)&&p.id in t.weights){let m=t.weights[p.id]/f,[A,y]=s(e,a,p.theta,!1);o+=A*m,i+=y*m}}}let c=e.getNoise(e,t);return o+=c[0],i+=c[1],[o,i]},m=function(){let[o,i]=a.mouse(e.overlay.node()),r=function(e,t,n){return[t,n]=c(e,t,n),Math.sqrt(t*t+n*n)}(e,o,i),d=Math.abs(r-n);e.focusIndicatorActionInRange=d<h,t.classed("ring-focus-indicator-action-possible",e.focusIndicatorActionInRange);let g=l(e,o,i),u=s(e,n,g,!0);t.attr("transform",`translate(${u[0]}, ${u[1]})`)};function A(){e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint||e.lasso.items().classed("within-current-lasso-selection",!1).classed("lassoed-point",!1)}function y(){e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint||(e.lasso.possibleItems().classed("within-current-lasso-selection",!0),e.lasso.notPossibleItems().classed("within-current-lasso-selection",!1))}function I(){if(e.focusIndicatorOverAnchor||e.focusIndicatorActionInRange||e.hoveringOverPoint)return;e.lasso.items().classed("within-current-lasso-selection",!1);let t=[];e.lasso.selectedItems().each((e=>{t=[...t,e.id]})),e.model.set("lassoedPointIDs",t),e.touch(),e.model.send({type:"lasso_change",pointIDs:t})}e.addVizAnchor=function(n){e.localAnchors.push(i.cloneDeep(n)),e.svg.append("circle").attr("id","anchor-"+n.id.toString()).classed("anchor",!0).attr("r",v).on("mouseover",(()=>t.classed("ring-focus-indicator-anchor-hover",!0))).on("mouseout",(()=>t.classed("ring-focus-indicator-anchor-hover",!1))).on("mousemove",(()=>e.overlay.node().dispatchEvent(new MouseEvent(a.event.type,a.event)))).on("click",(()=>{let t=e.model.get("selectedAnchorID");""!=t&&e.svg.select("#anchor-"+t).classed("anchor-selected",!1),t=n.id,e.svg.select("#anchor-"+t).classed("anchor-selected",!0),e.model.set("selectedAnchorID",t),e.touch()})).call(a.drag().on("start",(()=>{return o=n,e.anchorDragging=!0,e.draggingAnchorPrevTheta=o.theta,e.svg.select("#anchor-"+o.id.toString()).classed("anchor-dragging",!0),void t.classed("ring-focus-indicator-active",!0);var o})).on("drag",(()=>function(t){let n=a.mouse(e.overlay.node()),o=l(e,n[0],n[1]);t.theta=o,e.localAnchors[d(t.id,e.localAnchors)].theta=o,e.updateAnchorDisplayPos(t),e.updateDataPointPositionsImmediate(),m()}(n))).on("end",(()=>function(n){e.anchorDragging=!1;let o=u(e);(function(e,t){for(let n of t)if(n.id===e)return n;return null}(n.id,o)).theta=n.theta,e.svg.select("#anchor-"+n.id.toString()).classed("anchor-dragging",!1),t.classed("ring-focus-indicator-active",!1),n.theta!==e.draggingAnchorPrevTheta&&(f(e,o),e.model.send({type:"anchor_drag",theta:n.theta,id:n.id}))}(n)))),e.svg.append("text").classed("anchor-label",!0).attr("id","anchor-text-"+n.id.toString()),e.updateVizAnchorAttrs(n),e.updateAnchorDisplayPos(n)},e.updateVizAnchorAttrs=function(t){let n=e.svg.select("#anchor-"+t.id.toString()),o=e.svg.select("#anchor-text-"+t.id.toString());void 0!==t.color?n.style("fill",t.color):n.style("fill",null),o.text(t.name)},e.updateAnchorDisplayPos=function(t){n=e.model.get("radius");let o=s(e,n,t.theta,!0),i=s(e,n+h,t.theta,!0),a=e.svg.select("#anchor-"+t.id.toString()),r=e.svg.select("#anchor-text-"+t.id.toString());var c;a.attr("cx",o[0]).attr("cy",o[1]),r.attr("x",i[0]).attr("y",i[1]).attr("text-anchor",(c=t.theta)>Math.PI/4&&c<3*Math.PI/4||c>5*Math.PI/4&&c<7*Math.PI/4?"middle":c<Math.PI/4||c>7*Math.PI/4?"start":c<5*Math.PI/4&&c>3*Math.PI/4?"end":"ERROR")},e.updateDataPointPositionsImmediate=function(){n=e.model.get("radius"),o=e.model.get("margin"),e.svg.selectAll(".datapoint").attr("cx",(e=>p(e)[0]+n+o.left)).attr("cy",(e=>p(e)[1]+n+o.top))},e.getNoise=function(e,t){if(void 0===e.noise&&(e.noise={}),t.id in e.noise)return e.noise[t.id];let n=e.model.get("noiseMagnitude"),o=Math.random()*n-n/2,i=Math.random()*n-n/2;return e.noise[t.id]=[o,i],[o,i]},e.enterDatapoints=function(){let t=e.model.get("data"),n=e.model.get("radius"),o=e.model.get("margin"),i=e.model.get("pointSize"),s=e.svg.selectAll(".datapoint").data(t,(e=>e.id.toString()));s.enter().append("circle").classed("datapoint",!0).attr("cx",(function(){return n+o.left})).attr("cy",(function(){return n+o.top})).attr("r",i).attr("fill",(e=>void 0===e.color?"green":e.color)).classed("labeled-point",(e=>void 0!==e.labeled&&e.labeled)).on("mouseover",(t=>{e.model.set("selectedDataPointID",t.id.toString()),e.touch(),e.model.send({type:"point_hover",pointID:t.id})})).on("mousemove",(()=>e.overlay.node().dispatchEvent(new MouseEvent(a.event.type,a.event)))),s.exit().remove(),function(){let t=e.model.get("data"),n=e.svg.selectAll(".datapoint").data(t);e.lasso=r.lasso().closePathSelect(!0).closePathDistance(100).items(n).targetArea(e.svg).on("start",A).on("draw",y).on("end",I),e.svg.call(e.lasso)}()},e.animateDatapoints=function(){let t=e.model.get("radius"),n=e.model.get("margin"),o=e.model.get("data"),i=e.svg.selectAll(".datapoint").data(o,(e=>e.id.toString()));function a(e){return void 0===e.visible||e.visible}i.style("visibility","visible"),i.transition().duration(e.model.get("animationTime")).attr("cx",(e=>p(e)[0]+t+n.left)).attr("cy",(e=>p(e)[1]+t+n.top)).style("fill",(e=>e.color)).style("opacity",(e=>a(e)?1:0)).on("end",(()=>{this.svg.selectAll(".datapoint").style("visibility",(e=>a(e)?"visible":"hidden"))})),i.classed("labeled-point",(e=>void 0!==e.labeled&&e.labeled))},function(){e.localAnchors=[];let i=document.createElementNS("http://www.w3.org/2000/svg","svg");e.el.appendChild(i),e.el.setAttribute("class","jupyter-widget anchorviz"),e.width=2*n+o.left+o.right,e.height=2*n+o.top+o.bottom,e.svg=a.select(i),e.svg.attr("width",e.width).attr("height",e.height),e.ring=e.svg.append("circle").attr("class","ring").attr("r",n).attr("cx",n+o.left).attr("cy",n+o.top),t=e.svg.append("g").attr("class","ring-focus-indicator"),t.append("circle").attr("r",e.model.get("focusIndicatorSize")),e.overlay=e.svg.append("rect").attr("class","click-overlay").attr("width",e.width).attr("height",e.height).on("mousemove",m).on("click",(function(){!function(){if(e.focusIndicatorActionInRange){let[t,n]=a.mouse(e.overlay.node()),o=l(e,t,n),i=e.model.get("anchors"),r={id:(parseInt(g(i))+1).toString(),theta:o,name:"New Anchor"},s=[...i,r];f(e,s),e.model.send({type:"anchor_add",theta:o,newAnchor:r})}}()}));for(let t of u(e))e.addVizAnchor(t);e.enterDatapoints(),e.animateDatapoints()}()}n(840);class m extends o.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"AnchorVizModel",_view_name:"AnchorVizView",_model_module:"ipyanchorviz",_view_module:"ipyanchorviz",_model_module_version:"0.2.2",_view_module_version:"0.2.2",anchors:[],selectedAnchorID:"",data:[],selectedDataPointID:"",lassoedPointIDs:[],margin:{left:80,right:80,top:30,bottom:30},radius:275,ringInnerPadding:35,anchorTextOffset:20,pointSize:2,anchorSize:6,focusIndicatorSize:8.5,focusIndicatorActionDistance:20,autoNorm:!1,noiseMagnitude:15,animationTime:2e3}}}class A extends o.DOMWidgetView{render(){p(this),this.model.on("change:anchors",this.anchorsChange,this),this.model.on("change:selectedAnchorID",this.selectedAnchorChange,this),this.model.on("change:data",this.dataChange,this),this.model.on("change:selectedDataPointID",this.selectedDataPointChange,this),this.model.on("change:lassoedPointIDs",this.lassoedPointsChange,this)}anchorsChange(){!function(e){let t=e.model.previous("anchors"),n=u(e);for(let o of n)h(o,t)?(console.log("Updating "+o.id.toString()),e.updateVizAnchorAttrs(o),e.updateAnchorDisplayPos(o)):(console.log("Adding from update "+o.id.toString()),e.addVizAnchor(o));let o=!1;for(let i of t)h(i,n)||(o=!0,console.log("Removing "+i.id.toString()),e.svg.select("#anchor-"+i.id.toString()).remove(),e.svg.select("#anchor-text-"+i.id.toString()).remove());e.localAnchors=n,o?(console.log("updating data"),v(e)):e.updateDataPointPositionsImmediate()}(this)}selectedAnchorChange(){var e;(e=this).svg.selectAll(".anchor").classed("anchor-selected",!1),e.svg.select("#anchor-"+e.model.get("selectedAnchorID").toString()).classed("anchor-selected",!0)}dataChange(){v(this)}selectedDataPointChange(){var e;(e=this).svg.selectAll(".datapoint").classed("selected-point",(t=>t.id===e.model.get("selectedDataPointID")))}lassoedPointsChange(){!function(e){let t=e.model.get("lassoedPointIDs");e.svg.selectAll(".datapoint").classed("lassoed-point",(e=>t.includes(e.id)))}(this)}}const y={i8:"0.2.2"}},261:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a,helloWidgetPlugin:()=>i});var o=n(791);const i={id:"ipyanchorviz:plugin",requires:[n(672).IJupyterWidgetRegistry],activate:function(e,t){t.registerWidget({name:"ipyanchorviz",version:o.version,exports:{AnchorVizModel:o.AnchorVizModel,AnchorVizView:o.AnchorVizView}})},autoStart:!0},a=i},338:(e,t,n)=>{n.d(t,{Z:()=>a});var o=n(645),i=n.n(o)()((function(e){return e[1]}));i.push([e.id,".anchorviz .ring {\n    stroke: var(--ringColor, grey);\n    fill: #222222;\n}\n\n.anchorviz .click-overlay {\n    fill: none;\n    pointer-events: all;\n}\n\n.anchorviz .ring-focus-indicator circle {\n    stroke: var(--focusStroke, red);\n    fill: none;\n}\n\n.anchorviz .ring-focus-indicator-action-possible circle {\n    stroke: var(--focusStrokeActionPossible, #44DDFF) !important;\n}\n\n.anchorviz .ring-focus-indicator-anchor-hover circle {\n    stroke: var(--focusStrokeAnchorHover, #FFDD44) !important;\n}\n\n.anchorviz .ring-focus-indicator-active circle {\n    stroke: var(--anchorDraggingColor, #99FFAA) !important;\n}\n\n.anchorviz .anchor {\n    pointer-events: all;\n    fill: var(--defaultAnchorColor, grey);\n}\n\n.anchorviz .anchor-selected {\n    fill: var(--selectedAnchorColor, #99AAFF) !important;\n}\n.anchorviz .anchor-dragging {\n    fill: var(--anchorDraggingColor, #99FFAA) !important;\n}\n\n.anchorviz .anchor-label {\n    fill: var(--textColor, white);\n    font-size: 12px;\n    font-family: arial;\n}\n\n.anchorviz .labeled-point {\n    stroke: var(--labeledPointColor, #FFFFFF) !important;\n    stroke-width: 1px;\n}\n.anchorviz .lassoed-point {\n    stroke: var(--lassoedPointColor, #22AA22) !important;\n    stroke-width: 1px;\n}\n.anchorviz .selected-point {\n    stroke: var(--selectedPointColor, #FF0000) !important;\n}\n.anchorviz .within-current-lasso-selection {\n    stroke: var(--lassoingColor, green) !important;\n    stroke-width: 2px;\n}\n\n.anchorviz .lasso path {\n    stroke: rgb(80, 80, 80);\n    stroke-width: 2px;\n}\n.anchorviz .lasso .drawn {\n    fill-opacity: 0.05;\n}\n.anchorivz .lasso .loop_close {\n    fill: none;\n    stroke-dasharray: 4, 4;\n}\n",""]);const a=i},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var i={};if(o)for(var a=0;a<this.length;a++){var r=this[a][0];null!=r&&(i[r]=!0)}for(var s=0;s<e.length;s++){var c=[].concat(e[s]);o&&i[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},840:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});var o=n(379),i=n.n(o),a=n(338);i()(a.Z,{insert:"head",singleton:!1});const r=a.Z.locals||{}},379:(e,t,n)=>{var o,i=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),a=[];function r(e){for(var t=-1,n=0;n<a.length;n++)if(a[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},o=[],i=0;i<e.length;i++){var s=e[i],c=t.base?s[0]+t.base:s[0],l=n[c]||0,d="".concat(c," ").concat(l);n[c]=l+1;var h=r(d),g={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(a[h].references++,a[h].updater(g)):a.push({identifier:d,updater:v(g,t),references:1}),o.push(d)}return o}function c(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var a=n.nc;a&&(o.nonce=a)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var r=i(e.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(t)}return t}var l,d=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function h(e,t,n,o){var i=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=d(t,i);else{var a=document.createTextNode(i),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(a,r[t]):e.appendChild(a)}}function g(e,t,n){var o=n.css,i=n.media,a=n.sourceMap;if(i?e.setAttribute("media",i):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var u=null,f=0;function v(e,t){var n,o,i;if(t.singleton){var a=f++;n=u||(u=c(t)),o=h.bind(null,n,a,!1),i=h.bind(null,n,a,!0)}else n=c(t),o=g.bind(null,n,t),i=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else i()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var i=r(n[o]);a[i].references--}for(var c=s(e,t),l=0;l<n.length;l++){var d=r(n[l]);0===a[d].references&&(a[d].updater(),a.splice(d,1))}n=c}}}}}]);