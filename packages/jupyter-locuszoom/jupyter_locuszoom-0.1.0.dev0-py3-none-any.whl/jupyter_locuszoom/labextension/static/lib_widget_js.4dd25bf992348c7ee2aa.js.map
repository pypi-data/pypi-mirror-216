{"version":3,"file":"lib_widget_js.4dd25bf992348c7ee2aa.js","mappings":"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","sources":["webpack://jupyter-locuszoom/./css/widget.css","webpack://jupyter-locuszoom/./src/version.ts","webpack://jupyter-locuszoom/./src/widget.ts","webpack://jupyter-locuszoom/./css/widget.css?a195"],"sourcesContent":["// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".custom-widget {\\n  background-color: lightseagreen;\\n  padding: 0px 2px;\\n}\\n\", \"\"]);\n// Exports\nmodule.exports = exports;\n","// Copyright (c) Michał Krassowski\n// Distributed under the terms of the Modified BSD License.\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst data = require('../package.json');\n\n/**\n * The _model_module_version/_view_module_version this package implements.\n *\n * The html widget manager assumes that this is the same as the npm package\n * version number.\n */\nexport const MODULE_VERSION = data.version;\n\n/*\n * The current package name.\n */\nexport const MODULE_NAME = data.name;\n","// Copyright (c) Michał Krassowski\n// Distributed under the terms of the Modified BSD License.\n\nimport {\n  DOMWidgetModel,\n  DOMWidgetView,\n  ISerializers,\n} from '@jupyter-widgets/base';\nimport { UUID } from '@lumino/coreutils';\nimport { Message } from '@lumino/messaging';\n\nimport LocusZoom from 'locuszoom';\n\nimport { MODULE_NAME, MODULE_VERSION } from './version';\n//import { untilReady } from './utils';\n\n// Import the CSS\nimport 'locuszoom/dist/locuszoom.css';\nimport '../css/widget.css';\n\nexport class LocusZoomModel extends DOMWidgetModel {\n  defaults() {\n    return {\n      ...super.defaults(),\n      _model_name: LocusZoomModel.model_name,\n      _model_module: LocusZoomModel.model_module,\n      _model_module_version: LocusZoomModel.model_module_version,\n      _view_name: LocusZoomModel.view_name,\n      _view_module: LocusZoomModel.view_module,\n      _view_module_version: LocusZoomModel.view_module_version,\n      build: 'GRCh38',\n      position: {\n        chrom: '1',\n        start: 0,\n        end: 5000000,\n      },\n      _associations_view: {}\n    };\n  }\n\n  static serializers: ISerializers = {\n    ...DOMWidgetModel.serializers,\n    // Add any extra serializers here\n  };\n\n  static model_name = 'LocusZoomModel';\n  static model_module = MODULE_NAME;\n  static model_module_version = MODULE_VERSION;\n  static view_name = 'LocusZoomView'; // Set to null if no view\n  static view_module = MODULE_NAME; // Set to null if no view\n  static view_module_version = MODULE_VERSION;\n}\n\ninterface IRequestOptions {\n  chr: string;\n  start: number;\n  end: number;\n}\n\nconst AssociationLZ = LocusZoom.Adapters.get('AssociationLZ');\n\n\nclass ModelAssociation extends AssociationLZ {\n  model: LocusZoomModel;\n  constructor(config: {model: LocusZoomModel}) {\n    super({});\n    this.model = config.model;\n  }\n\n  async _performRequest(options: IRequestOptions) {\n    /**\n    console.log('performing request', options);\n    await untilReady(() => {\n      const position = this.model.get('position');\n      return (\n        position.chr === options.chr\n        &&\n        position.start === options.start\n        &&\n        position.end === options.end\n        )\n    })\n    console.log('got it!');\n    */\n    return{\n      data: this.model.get('_associations_view'),\n      lastPage: 100\n    };\n  }\n}\n// A custom adapter should be added to the registry before using it\nLocusZoom.Adapters.add('ModelAssociation', ModelAssociation);\n\n\nexport class LocusZoomView extends DOMWidgetView {\n  container: HTMLDivElement;\n  plot: any;\n  constructor(options: any) {\n    super(options);\n    this.container = document.createElement('div');\n    this.container.id = 'locus-zoom-' + UUID.uuid4();\n    this.el.appendChild(this.container);\n  }\n   _processLuminoMessage(msg: Message, _super: (msg: Message) => void): void {\n       _super.call(this, msg);\n       switch (msg.type) {\n         case 'resize':\n           console.log('resize message')\n           window.requestAnimationFrame(() => this.plot.rescaleSVG());\n           break;\n       }\n  }\n  processPhosphorMessage(msg: Message): void {\n     this._processLuminoMessage(msg, super.processPhosphorMessage);\n }\n\n processLuminoMessage(msg: Message): void {\n     this._processLuminoMessage(msg, super.processLuminoMessage);\n }\n  render() {\n    const apiBase = \"https://portaldev.sph.umich.edu/api/v1/\";\n    const build = this.model.get('build');\n\n    var dataSources = new LocusZoom.DataSources();\n    dataSources\n      .add(\"assoc\", [\"ModelAssociation\", { model: this.model }])\n      .add(\"ld\", [\"LDServer\", { url: \"https://portaldev.sph.umich.edu/ld/\", source: '1000G', build, population: 'ALL' }])\n      .add(\"gene\", [\"GeneLZ\", { url: apiBase + \"annotation/genes/\", build }])\n      .add(\"recomb\", [\"RecombLZ\", { url: apiBase + \"annotation/recomb/results/\", build }])\n      .add(\"constraint\", [\"GeneConstraintLZ\", { url: \"https://gnomad.broadinstitute.org/api/\", build }]);\n\n    const initialState = this.positionState;\n    console.log(initialState);\n    const layout = LocusZoom.Layouts.get(\"plot\", \"standard_association\", {state: initialState});\n\n    // d3 assumes the node is already in the DOM and will fail if we do not attach it temporarily.\n    const attached = this.el.parentElement !== null;\n    if (!attached) {\n      document.body.appendChild(this.el);\n    }\n    const plot = LocusZoom.populate(\"#\" + this.container.id, dataSources, layout);\n    if (!attached) {\n      document.body.removeChild(this.el);\n    }\n    this.plot = plot;\n\n    plot.on('state_changed', () => {\n      console.log('state changed');\n      const position = this.model.get('position');\n      if (\n        plot.state.start == position.start\n        &&\n        plot.state.end == position.end\n        &&\n        plot.state.chr == position.chrom\n      ) {\n        return;\n      }\n      console.log('plot state changed, will set kernel state to',  plot.state)\n      this.model.set('position', {start: plot.state.start, end: plot.state.end, chr: plot.state.chr});\n      this.model.save_changes();\n    });\n\n    const updateState = () => {\n      console.log('kernel state changed, will set state to ', this.positionState);\n      plot.applyState({ ...this.positionState, ldrefvar: \"\" });\n    }\n\n    // listen to changes of state in kernel and update view accordingly\n    this.model.on('change:position', updateState);\n    this.displayed.then(() => {\n      this.plot.rescaleSVG();\n    });\n    //this.model.on('change:_associations_view', updateState);\n  }\n\n  get positionState() {\n    return this.model.get('position');\n  }\n}\n","var api = require(\"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../node_modules/css-loader/dist/cjs.js!./widget.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};"],"names":[],"sourceRoot":""}