{"version":3,"file":"lib_widget_js.b631ee8a6ff24aede47c.js","mappings":"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","sources":["webpack://jupyter-locuszoom/./css/widget.css","webpack://jupyter-locuszoom/./src/utils.ts","webpack://jupyter-locuszoom/./src/version.ts","webpack://jupyter-locuszoom/./src/widget.ts","webpack://jupyter-locuszoom/./css/widget.css?a195"],"sourcesContent":["// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".custom-widget {\\n  background-color: lightseagreen;\\n  padding: 0px 2px;\\n}\\n\", \"\"]);\n// Exports\nmodule.exports = exports;\n","async function sleep(timeout: number): Promise<void> {\n  return new Promise<void>((resolve) => {\n    setTimeout(() => {\n      resolve();\n    }, timeout);\n  });\n}\n\nexport function untilReady(\n  isReady: CallableFunction,\n  maxRetrials = 15,\n  interval = 75,\n  intervalModifier = (i: number) => i\n): Promise<CallableFunction> {\n  return (async () => {\n    let i = 0;\n    while (isReady() !== true) {\n      i += 1;\n      if (maxRetrials !== -1 && i > maxRetrials) {\n        throw Error('Too many retrials');\n      }\n      interval = intervalModifier(interval);\n      await sleep(interval);\n    }\n    return isReady;\n  })();\n}\n","// Copyright (c) Michał Krassowski\n// Distributed under the terms of the Modified BSD License.\n\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\n// eslint-disable-next-line @typescript-eslint/no-var-requires\nconst data = require('../package.json');\n\n/**\n * The _model_module_version/_view_module_version this package implements.\n *\n * The html widget manager assumes that this is the same as the npm package\n * version number.\n */\nexport const MODULE_VERSION = data.version;\n\n/*\n * The current package name.\n */\nexport const MODULE_NAME = data.name;\n","// Copyright (c) Michał Krassowski\n// Distributed under the terms of the Modified BSD License.\n\nimport {\n  DOMWidgetModel,\n  DOMWidgetView,\n  ISerializers,\n} from '@jupyter-widgets/base';\nimport { UUID } from '@lumino/coreutils';\nimport { Message } from '@lumino/messaging';\n\nimport LocusZoom from 'locuszoom';\n\nimport { MODULE_NAME, MODULE_VERSION } from './version';\nimport { untilReady } from './utils';\n\n// Import the CSS\nimport 'locuszoom/dist/locuszoom.css';\nimport '../css/widget.css';\n\nexport class LocusZoomModel extends DOMWidgetModel {\n  defaults() {\n    return {\n      ...super.defaults(),\n      _model_name: LocusZoomModel.model_name,\n      _model_module: LocusZoomModel.model_module,\n      _model_module_version: LocusZoomModel.model_module_version,\n      _view_name: LocusZoomModel.view_name,\n      _view_module: LocusZoomModel.view_module,\n      _view_module_version: LocusZoomModel.view_module_version,\n      build: 'GRCh38',\n      position: {\n        chr: '1',\n        start: 0,\n        end: 5000000,\n      },\n      _associations_view: {\n        range: {\n          chr: '1',\n          start: 0,\n          end: 5000000,\n        },\n      },\n    };\n  }\n\n  static serializers: ISerializers = {\n    ...DOMWidgetModel.serializers,\n    // Add any extra serializers here\n  };\n\n  static model_name = 'LocusZoomModel';\n  static model_module = MODULE_NAME;\n  static model_module_version = MODULE_VERSION;\n  static view_name = 'LocusZoomView'; // Set to null if no view\n  static view_module = MODULE_NAME; // Set to null if no view\n  static view_module_version = MODULE_VERSION;\n}\n\ninterface IRequestOptions {\n  chr: string;\n  start: number;\n  end: number;\n}\n\nconst AssociationLZ = LocusZoom.Adapters.get('AssociationLZ');\n\nclass ModelAssociation extends AssociationLZ {\n  model: LocusZoomModel;\n  constructor(config: { model: LocusZoomModel }) {\n    super({});\n    this.model = config.model;\n  }\n\n  async _performRequest(options: IRequestOptions) {\n    // TODO: find a way to fetch view properly\n    await untilReady(() => {\n      const view = this.model.get('_associations_view');\n      const position = view.range;\n      return (\n        position.chr === options.chr &&\n        position.start === options.start &&\n        position.end === options.end\n      );\n    });\n    return this.model.get('_associations_view');\n  }\n}\n// A custom adapter should be added to the registry before using it\nLocusZoom.Adapters.add('ModelAssociation', ModelAssociation);\n\nexport class LocusZoomView extends DOMWidgetView {\n  container: HTMLDivElement;\n  plot: any;\n  constructor(options: any) {\n    super(options);\n    this.container = document.createElement('div');\n    this.container.id = 'locus-zoom-' + UUID.uuid4();\n    this.el.appendChild(this.container);\n  }\n  _processLuminoMessage(msg: Message, _super: (msg: Message) => void): void {\n    _super.call(this, msg);\n    switch (msg.type) {\n      case 'resize':\n        console.log('resize message');\n        window.requestAnimationFrame(() => this.plot.rescaleSVG());\n        break;\n    }\n  }\n  processPhosphorMessage(msg: Message): void {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    this._processLuminoMessage(msg, super.processPhosphorMessage);\n  }\n\n  processLuminoMessage(msg: Message): void {\n    this._processLuminoMessage(msg, super.processLuminoMessage);\n  }\n  render() {\n    const apiBase = 'https://portaldev.sph.umich.edu/api/v1/';\n    const build = this.model.get('build');\n\n    const dataSources = new LocusZoom.DataSources();\n    dataSources\n      .add('assoc', ['ModelAssociation', { model: this.model }])\n      .add('ld', [\n        'LDServer',\n        {\n          url: 'https://portaldev.sph.umich.edu/ld/',\n          source: '1000G',\n          build,\n          population: 'ALL',\n        },\n      ])\n      .add('gene', ['GeneLZ', { url: apiBase + 'annotation/genes/', build }])\n      .add('recomb', [\n        'RecombLZ',\n        { url: apiBase + 'annotation/recomb/results/', build },\n      ])\n      .add('constraint', [\n        'GeneConstraintLZ',\n        { url: 'https://gnomad.broadinstitute.org/api/', build },\n      ]);\n    // TODO:\n    //.add(\"phewas\", [\"PheWASLZ\", {url: \"https://portaldev.sph.umich.edu/\" + \"api/v1/statistic/phewas/\", build: [build]}])\n\n    const initialState = this.positionState;\n    console.log(initialState);\n    const layout = LocusZoom.Layouts.get('plot', 'standard_association', {\n      state: initialState,\n    });\n\n    // d3 assumes the node is already in the DOM and will fail if we do not attach it temporarily.\n    const attached = this.el.parentElement !== null;\n    if (!attached) {\n      document.body.appendChild(this.el);\n    }\n    const plot = LocusZoom.populate(\n      '#' + this.container.id,\n      dataSources,\n      layout\n    );\n    if (!attached) {\n      document.body.removeChild(this.el);\n    }\n    this.plot = plot;\n\n    plot.on('state_changed', () => {\n      const position = this.model.get('position');\n      if (\n        plot.state.start === position.start &&\n        plot.state.end === position.end &&\n        plot.state.chr === position.chr\n      ) {\n        return;\n      }\n      console.log('plot state changed, will set kernel state to', plot.state);\n      this.model.set('position', {\n        start: plot.state.start,\n        end: plot.state.end,\n        chr: plot.state.chr,\n      });\n      this.model.save_changes();\n    });\n\n    const updateState = () => {\n      console.log(\n        'kernel state changed, will set state to ',\n        this.positionState\n      );\n      plot.applyState({ ...this.positionState, ldrefvar: '' });\n    };\n\n    // listen to changes of state in kernel and update view accordingly\n    this.model.on('change:position', updateState);\n    this.displayed.then(() => {\n      this.plot.rescaleSVG();\n    });\n  }\n\n  get positionState() {\n    return this.model.get('position');\n  }\n}\n","var api = require(\"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../node_modules/css-loader/dist/cjs.js!./widget.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};"],"names":[],"sourceRoot":""}