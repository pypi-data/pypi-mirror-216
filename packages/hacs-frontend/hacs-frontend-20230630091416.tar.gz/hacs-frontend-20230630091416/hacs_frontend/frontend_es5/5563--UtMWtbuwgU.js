"use strict";(self.webpackChunkhacs_frontend=self.webpackChunkhacs_frontend||[]).push([[5563],{25563:function(e,t,r){r.r(t),r.d(t,{HacsDonwloadDialog:function(){return H}});var i=r(88962),o=r(99312),a=r(81043),s=r(33368),n=r(71650),c=r(82390),l=r(69205),d=r(70906),h=r(91808),u=(r(14271),r(82692),r(68144)),p=r(79932),_=r(14516),g=r(18394),m=r(52138),f=r(51750),y=(r(23860),r(9828),r(39663),r(11285)),v=r(84643),k=r(8179),w=r(46797),b=r(61422),Z=r(98485),x=r(23792);function P(e,t,r){return z.apply(this,arguments)}function z(){return z=(0,a.Z)((0,o.Z)().mark((function e(t,r,i){var a,s,n,c,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new x.J("updateLovelaceResources"),e.next=3,(0,Z.eL)(t.connection);case 3:if(s=e.sent,n="/hacsfiles/".concat(r.full_name.split("/")[1]),c=T({repository:r,version:i}),l=s.find((function(e){return e.url.includes(n)})),a.debug({namespace:n,url:c,exsisting:l}),!l||l.url===c){e.next=14;break}return a.debug("Updating exsusting resource for ".concat(n)),e.next=12,(0,Z.id)(t,l.id,{url:c,res_type:l.type});case 12:e.next=18;break;case 14:if(s.map((function(e){return e.url})).includes(c)){e.next=18;break}return a.debug("Adding ".concat(c," to Lovelace resources")),e.next=18,(0,Z.SN)(t,{url:c,res_type:"module"});case 18:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}var R,L,D,C,S,E,A,B,I,M,T=function(e){return"/hacsfiles/".concat(e.repository.full_name.split("/")[1],"/").concat(e.repository.file_name).concat(e.skipTag?"":"?hacstag=".concat(function(e,t){return String("".concat(e.id).concat((t||e.installed_version||e.selected_tag||e.available_version).replace(/\D+/g,"")))}(e.repository,e.version)))},H=(0,h.Z)([(0,p.Mo)("hacs-download-dialog")],(function(e,t){var r,h,Z,x,z=function(t){(0,l.Z)(i,t);var r=(0,d.Z)(i);function i(){var t;(0,n.Z)(this,i);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return t=r.call.apply(r,[this].concat(a)),e((0,c.Z)(t)),t}return(0,s.Z)(i)}(t);return{F:z,d:[{kind:"field",decorators:[(0,p.Cb)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,p.SB)()],key:"_waiting",value:function(){return!0}},{kind:"field",decorators:[(0,p.SB)()],key:"_installing",value:function(){return!1}},{kind:"field",decorators:[(0,p.SB)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,p.SB)()],key:"_repository",value:void 0},{kind:"field",decorators:[(0,p.SB)()],key:"_dialogParams",value:void 0},{kind:"method",key:"showDialog",value:(x=(0,a.Z)((0,o.Z)().mark((function e(t){var r=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._dialogParams=t,this._waiting=!1,!t.repository){e.next=6;break}this._repository=t.repository,e.next=8;break;case 6:return e.next=8,this._fetchRepository();case 8:return(0,w.CE)(this.hass,(function(e){return r._error=e}),v.p.ERROR),e.next=11,this.updateComplete;case 11:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{kind:"method",key:"closeDialog",value:function(){this._dialogParams=void 0,this._repository=void 0,this._error=void 0,this._installing=!1,this._waiting=!1,(0,g.B)(this,"dialog-closed",{dialog:this.localName})}},{kind:"field",key:"_getInstallPath",value:function(){return(0,_.Z)((function(e){var t=e.local_path;return["template","theme"].includes(e.category)&&(t="".concat(t,"/").concat(e.file_name)),t}))}},{kind:"method",key:"_fetchRepository",value:(Z=(0,a.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.nj)(this.hass,this._dialogParams.repositoryId);case 2:this._repository=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return Z.apply(this,arguments)})},{kind:"method",key:"render",value:function(){var e,t=this;if(!this._dialogParams||!this._repository)return u.Ld;var r=this._getInstallPath(this._repository),o=[{name:"beta",selector:{boolean:{}}},{name:"version",selector:{select:{options:this._repository.releases.concat("hacs/integration"===this._repository.full_name||this._repository.hide_default_branch?[]:[this._repository.default_branch]),mode:"dropdown"}}}];return(0,u.dy)(R||(R=(0,i.Z)([' <ha-dialog open scrimClickAction escapeKeyAction .heading="','" @closed="','"> <div class="content"> '," ",' <div class="note"> '," "," "," </div> "," ",' </div> <mwc-button slot="secondaryAction" @click="','" dialogInitialFocus> ',' </mwc-button> <mwc-button slot="primaryAction" ?disabled="','" @click="','"> '," </mwc-button> </ha-dialog> "])),this._repository.name,this.closeDialog,"version"===this._repository.version_or_commit?(0,u.dy)(L||(L=(0,i.Z)([' <ha-form .disabled="','" .data="','" .schema="','" .computeLabel="','" @value-changed="','"> </ha-form> '])),this._waiting,"version"===this._repository.version_or_commit?{beta:this._repository.beta,version:this._repository.releases[0]}:{},o,(function(e){return"beta"===e.name?t._dialogParams.hacs.localize("dialog_download.show_beta"):t._dialogParams.hacs.localize("dialog_download.select_version")}),this._valueChanged):u.Ld,this._repository.can_download?"":(0,u.dy)(D||(D=(0,i.Z)(['<ha-alert alert-type="error" .rtl="','"> '," </ha-alert>"])),(0,f.HE)(this.hass),this._dialogParams.hacs.localize("confirm.home_assistant_version_not_correct",{haversion:this.hass.config.version,minversion:this._repository.homeassistant})),this._dialogParams.hacs.localize("dialog_download.note_downloaded",{location:(0,u.dy)(C||(C=(0,i.Z)(["<code>'","'</code>"])),r)}),"plugin"===this._repository.category&&"storage"!==this._dialogParams.hacs.info.lovelace_mode?(0,u.dy)(S||(S=(0,i.Z)([" <p>","</p> <pre>\n                url: ","\n                type: module\n                </pre> "])),this._dialogParams.hacs.localize("dialog_download.lovelace_instruction"),T({repository:this._repository,skipTag:!0})):u.Ld,"integration"===this._repository.category?(0,u.dy)(E||(E=(0,i.Z)(["<p>","</p>"])),this._dialogParams.hacs.localize("dialog_download.restart")):u.Ld,null!==(e=this._error)&&void 0!==e&&e.message?(0,u.dy)(A||(A=(0,i.Z)(['<ha-alert alert-type="error" .rtl="','"> '," </ha-alert>"])),(0,f.HE)(this.hass),this._error.message):u.Ld,this._installing?(0,u.dy)(B||(B=(0,i.Z)(["<mwc-linear-progress indeterminate></mwc-linear-progress>"]))):u.Ld,this.closeDialog,this._dialogParams.hacs.localize("common.cancel"),!this._repository.can_download||this._waiting||this._installing,this._installRepository,this._dialogParams.hacs.localize("common.download"))}},{kind:"method",key:"_valueChanged",value:(h=(0,a.Z)((0,o.Z)().mark((function e(t){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!1,this._repository.beta===t.detail.value.beta){e.next=6;break}return r=!0,this._waiting=!0,e.next=6,(0,w.EK)(this.hass,this._dialogParams.repositoryId,t.detail.value.beta);case 6:if(!t.detail.value.version){e.next=11;break}return r=!0,this._waiting=!0,e.next=11,(0,k.zD)(this.hass,this._dialogParams.repositoryId,t.detail.value.version);case 11:if(!r){e.next=15;break}return e.next=14,this._fetchRepository();case 14:this._waiting=!1;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{kind:"method",key:"_installRepository",value:(r=(0,a.Z)((0,o.Z)().mark((function e(){var t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._installing=!0,this._repository){e.next=3;break}return e.abrupt("return");case 3:return r=this._repository.selected_tag||this._repository.available_version||this._repository.default_branch,e.next=6,(0,k.hZ)(this.hass,String(this._repository.id),"commit"!==(null===(t=this._repository)||void 0===t?void 0:t.version_or_commit)?r:void 0);case 6:if(this._dialogParams.hacs.log.debug(this._repository.category,"_installRepository"),this._dialogParams.hacs.log.debug(this._dialogParams.hacs.info.lovelace_mode,"_installRepository"),"plugin"!==this._repository.category||"storage"!==this._dialogParams.hacs.info.lovelace_mode){e.next=11;break}return e.next=11,P(this.hass,this._repository,r);case 11:this._installing=!1,"plugin"===this._repository.category&&(0,y.g7)(this,{title:this._dialogParams.hacs.localize("common.reload"),text:(0,u.dy)(I||(I=(0,i.Z)(["","<br>",""])),this._dialogParams.hacs.localize("dialog.reload.description"),this._dialogParams.hacs.localize("dialog.reload.confirm")),dismissText:this._dialogParams.hacs.localize("common.cancel"),confirmText:this._dialogParams.hacs.localize("common.reload"),confirm:function(){m.E.location.href=m.E.location.href}});case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return[b.w,(0,u.iv)(M||(M=(0,i.Z)([".note{margin-top:12px}.lovelace{margin-top:8px}pre{white-space:pre-line;user-select:all}mwc-linear-progress{margin-bottom:-8px;margin-top:4px}"])))]}}]}}),u.oi)},8179:function(e,t,r){r.d(t,{hZ:function(){return s},nj:function(){return a},zD:function(){return n}});var i=r(99312),o=r(81043),a=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.connection.sendMessagePromise({type:"hacs/repository/info",repository_id:r}));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),s=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r,o){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.connection.sendMessagePromise({type:"hacs/repository/download",repository:r,version:o}));case 1:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}(),n=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,r,o){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.connection.sendMessagePromise({type:"hacs/repository/version",repository:r,version:o}));case 1:case"end":return e.stop()}}),e)})));return function(t,r,i){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=5563--UtMWtbuwgU.js.map