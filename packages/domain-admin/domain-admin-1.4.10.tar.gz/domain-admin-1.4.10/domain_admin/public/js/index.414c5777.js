import{i as H,E as W}from"./event-enums.6c6f25e7.js";import{S as G,u as E}from"./SelectGroup.60b5bafa.js";import{_ as C,d as P,r as K,g as M}from"./index.76457c54.js";import{ah as i,ar as A,Q as z,o as _,c as D,V as o,P as a,a as m,T as w,O as y,S as I,U as f,L as Q,ax as L,aA as X,a9 as J}from"./vendor-vue.edbe275b.js";import{C as N}from"./ConnectStatus.8544007b.js";import{E as q,A as Y,a as Z,b as ee,C as te}from"./ConditionFilterGroup.af653ee9.js";import{F as oe}from"./vendor-lib.4c56f242.js";import{a as ne}from"./element-plus.dcbfaaa8.js";import"./element-icon.ade3aa7e.js";const ae={domain:[{message:"\u57DF\u540D\u4E0D\u80FD\u4E3A\u7A7A",required:!0,trigger:"blur"}],port:[{required:!0,trigger:"blur",validator:(n,e,t)=>{if(!e)return t();if(H(e))t();else return t(new Error("\u7AEF\u53E3\u53F7\u53EA\u80FD\u662F\u6570\u5B57"))}}]},le={name:"",props:{row:{type:Object,default:null}},components:{SelectGroup:G},data(){return{loading:!1,form:{domain:"",alias:"",port:443,group_id:"",is_dynamic_host:!1},rules:ae}},computed:{disabledDomain(){return!!this.row}},methods:{async getData(){if(this.loading=!0,this.row){let n={id:this.row.id},t=(await this.$http.getDomainById(n)).data;this.form.domain=t.domain,this.form.alias=t.alias,this.form.group_id=t.group_id,this.form.port=t.port,this.form.is_dynamic_host=t.is_dynamic_host,this.form.group_id==0&&(this.form.group_id="")}this.loading=!1},handleCancel(){this.$emit("on-cancel")},handleSubmit(){console.log("handleSubmit",this.form),this.$refs.form.validate(n=>{if(console.log(n),n)this.confirmSubmit();else return!1})},async confirmSubmit(){let n=this.$loading({fullscreen:!0}),e={domain:this.form.domain.trim(),alias:this.form.alias.trim(),group_id:this.form.group_id,port:this.form.port,is_dynamic_host:this.form.is_dynamic_host},t=null;this.row?(e.id=this.row.id,t=await this.$http.updateDomainById(e)):t=await this.$http.addDomain(e),t.ok&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")),this.$nextTick(()=>{n.close()})}},created(){this.getData()}},ie={class:"text-center"};function se(n,e,t,u,l,s){const c=i("el-input"),d=i("el-form-item"),h=i("el-switch"),x=i("Warning"),b=i("el-icon"),k=i("el-link"),v=i("el-tooltip"),S=i("SelectGroup"),V=i("el-form"),R=i("el-button"),O=A("loading");return z((_(),D("div",null,[o(V,{ref:"form",model:l.form,rules:l.rules,"label-width":"70px"},{default:a(()=>[o(d,{label:"\u57DF\u540D",prop:"domain"},{default:a(()=>[o(c,{type:"text",modelValue:l.form.domain,"onUpdate:modelValue":e[0]||(e[0]=g=>l.form.domain=g),placeholder:"\u8BF7\u8F93\u5165\u57DF\u540D"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u7AEF\u53E3",prop:"port"},{default:a(()=>[o(c,{type:"text",modelValue:l.form.port,"onUpdate:modelValue":e[1]||(e[1]=g=>l.form.port=g),placeholder:"\u8BF7\u8F93\u5165\u7AEF\u53E3"},null,8,["modelValue"])]),_:1}),o(d,{label:"\u52A8\u6001\u4E3B\u673A",prop:"is_dynamic_host"},{default:a(()=>[o(h,{modelValue:l.form.is_dynamic_host,"onUpdate:modelValue":e[2]||(e[2]=g=>l.form.is_dynamic_host=g)},null,8,["modelValue"]),o(v,{effect:"dark",content:"\u52A8\u6001\u4E3B\u673AIP\u5730\u5740\uFF1A\u6BCF\u6B21\u81EA\u52A8\u66F4\u65B0\u5C06\u4F1A\u91CD\u65B0\u83B7\u53D6\u4E3B\u673A\u5217\u8868",placement:"top-start","show-after":500},{default:a(()=>[o(k,{underline:!1},{default:a(()=>[o(b,{class:"ml-sm"},{default:a(()=>[o(x)]),_:1})]),_:1})]),_:1})]),_:1}),o(d,{label:"\u5206\u7EC4",prop:"group_id"},{default:a(()=>[o(S,{class:"w-[150px]",modelValue:l.form.group_id,"onUpdate:modelValue":e[3]||(e[3]=g=>l.form.group_id=g),clearable:""},null,8,["modelValue"])]),_:1}),o(d,{label:"\u5907\u6CE8",prop:"alias"},{default:a(()=>[o(c,{type:"textarea",modelValue:l.form.alias,"onUpdate:modelValue":e[4]||(e[4]=g=>l.form.alias=g),rows:3,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),m("div",ie,[o(R,{onClick:s.handleCancel},{default:a(()=>[w("\u53D6 \u6D88")]),_:1},8,["onClick"]),o(R,{type:"primary",onClick:s.handleSubmit},{default:a(()=>[w("\u786E \u5B9A")]),_:1},8,["onClick"])])])),[[O,l.loading]])}const re=C(le,[["render",se]]),de={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:re},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91\u57DF\u540D":"\u6DFB\u52A0\u57DF\u540D"},dialogVisible:{get(){return this.visible},set(n){this.$emit("update:visible",n)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose(),this.$emit("on-success")}},created(){}};function ce(n,e,t,u,l,s){const c=i("DataForm"),d=i("el-dialog");return _(),y(d,{title:s.dialogTitle,modelValue:s.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=h=>s.dialogVisible=h),width:"400px",center:"","append-to-body":"","lock-scroll":!1},{default:a(()=>[s.dialogVisible?(_(),y(c,{key:0,row:t.row,onOnCancel:s.handleClose,onOnSuccess:s.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):I("",!0)]),_:1},8,["title","modelValue"])}const j=C(de,[["render",ce]]),me={name:"",props:{row:{type:Object,default:null}},components:{ConnectStatus:N,ExpireDays:q,AddressList:Y},data(){return{form:{domain:"",domain_url:"",ip:"",start_time:"",expire_time:"",check_time:"",connect_status:"",total_days:"",expire_days:"",create_time:"",update_time:"",real_time_expire_days:"",domain_start_time:"",domain_expire_time:"",real_time_domain_expire_days:"",alias:"",domain_auto_update:"",domain_auto_update_label:"",domain_expire_monitor:"",domain_check_time_label:"",port:"",address_count:0,group:null},ipInfo:{isp:""}}},computed:{},methods:{async getData(){if(this.row){let n={id:this.row.id};const e=await this.$http.getDomainById(n);if(!e.ok)return;let t=e.data;this.form.domain=t.domain,this.form.domain_url=t.domain_url,this.form.ip=t.ip,this.form.start_time=t.start_time,this.form.expire_time=t.expire_time,this.form.check_time=t.check_time,this.form.connect_status=t.connect_status,this.form.total_days=t.total_days,this.form.expire_days=t.expire_days,this.form.real_time_expire_days=t.real_time_expire_days,this.form.create_time=t.create_time,this.form.update_time_label=t.update_time_label,this.form.domain_auto_update=t.domain_auto_update,this.form.domain_auto_update_label=t.domain_auto_update==!0?"\u662F":"\u5426",this.form.domain_expire_monitor=t.domain_expire_monitor==!0?"\u662F":"\u5426",this.form.domain_check_time_label=t.domain_check_time_label,this.form.port=t.port,this.form.alias=t.alias,this.form.domain_start_time=t.domain_start_time,this.form.domain_expire_time=t.domain_expire_time,this.form.real_time_domain_expire_days=t.real_time_domain_expire_days,this.form.address_count=t.address_count,this.form.group=t.group}},handleCancel(){this.$emit("on-cancel")},async handleUpdateRowDomainInfo(){let n=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),e={domain_id:this.row.id};(await this.$http.updateDomainCertInfoById(e)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.getData()),n.close()},async getIpInfo(){let n={ip:this.form.ip};const e=await this.$http.getIpInfo(n);e.code==0&&(this.ipInfo=e.data)}},created(){this.getData()}},ue={class:"domain-detail"},pe={class:"mo-form-detail grid grid-cols-2"},_e={key:0},he={key:1},fe={class:"flex justify-between flex-1"},ge={class:"truncate"},we={class:"mo-form-detail mt-[20px]"},be={class:"truncate"},ye={class:"text-center mt-md"};function De(n,e,t,u,l,s){const c=i("el-link"),d=i("el-form-item"),h=i("el-form"),x=i("ExpireDays"),b=i("Refresh"),k=i("el-icon"),v=i("el-button");return _(),D("div",ue,[m("div",pe,[o(h,{"label-width":"130px"},{default:a(()=>[o(d,{label:"\u57DF\u540D",prop:"domain"},{default:a(()=>[o(c,{underline:!1,href:l.form.domain_url,target:"_blank"},{default:a(()=>[w(f(l.form.domain),1)]),_:1},8,["href"])]),_:1}),o(d,{label:"\u8BC1\u4E66\u9881\u53D1\u65F6\u95F4",prop:"create_time"},{default:a(()=>[m("span",null,f(l.form.start_time||"-"),1)]),_:1}),o(d,{label:"\u8BC1\u4E66\u8FC7\u671F\u65F6\u95F4",prop:"create_time"},{default:a(()=>[m("span",null,f(l.form.expire_time||"-"),1)]),_:1}),o(d,{label:"\u5206\u7EC4",prop:"create_time"},{default:a(()=>[l.form.group?(_(),D("span",_e,f(l.form.group.name||"-"),1)):(_(),D("span",he,"-"))]),_:1})]),_:1}),o(h,{"label-width":"130px",style:{"margin-right":"-1px"}},{default:a(()=>[o(d,{label:"\u7AEF\u53E3\u53F7",prop:"domain"},{default:a(()=>[m("span",null,f(l.form.port||"-"),1)]),_:1}),o(d,{label:"\u5269\u4F59\u5929\u6570",prop:"create_time"},{default:a(()=>[o(x,{value:l.form.real_time_expire_days},null,8,["value"])]),_:1}),o(d,{label:"\u68C0\u67E5\u65F6\u95F4",prop:"isp"},{default:a(()=>[m("div",fe,[m("span",ge,f(l.form.update_time_label||"-"),1),o(c,{underline:!1,type:"primary",class:"mr-sm",onClick:s.handleUpdateRowDomainInfo},{default:a(()=>[o(k,null,{default:a(()=>[o(b)]),_:1})]),_:1},8,["onClick"])])]),_:1}),o(d,{label:"\u4E3B\u673A\u6570\u91CF",prop:"create_time"},{default:a(()=>[m("span",null,f(l.form.address_count||"-"),1)]),_:1})]),_:1})]),m("div",we,[o(h,{"label-width":"130px"},{default:a(()=>[o(d,{label:"\u5907\u6CE8",prop:"isp"},{default:a(()=>[m("span",be,f(l.form.alias||"-"),1)]),_:1})]),_:1})]),m("div",ye,[o(v,{type:"primary",onClick:s.handleCancel},{default:a(()=>[w("\u5173 \u95ED")]),_:1},8,["onClick"])])])}const Ce=C(me,[["render",De]]),xe={name:"",props:{row:{type:Object,default:null},visible:{type:Boolean,default:!1}},emits:["update:visible"],components:{DataForm:Ce},data(){return{}},computed:{dialogTitle(){return this.row?"\u7F16\u8F91":"\u6DFB\u52A0"},dialogVisible:{get(){return this.visible},set(n){this.$emit("update:visible",n)}}},methods:{handleClose(){this.dialogVisible=!1},handleOpen(){this.dialogVisible=!0},handleSuccess(){this.handleClose()},handleDialogClose(){this.$emit("on-success")}},created(){}};function ke(n,e,t,u,l,s){const c=i("DataForm"),d=i("el-dialog");return _(),y(d,{title:"\u8BC1\u4E66\u8BE6\u60C5",modelValue:s.dialogVisible,"onUpdate:modelValue":e[0]||(e[0]=h=>s.dialogVisible=h),width:"800px",center:"","append-to-body":"","lock-scroll":!1,onClose:s.handleDialogClose},{default:a(()=>[s.dialogVisible?(_(),y(c,{key:0,row:t.row,onOnCancel:s.handleClose,onOnSuccess:s.handleSuccess},null,8,["row","onOnCancel","onOnSuccess"])):I("",!0)]),_:1},8,["modelValue","onClose"])}const ve=C(xe,[["render",ke]]),Se={name:"",components:{DataFormDialog:j,DataDetailDialog:ve,ConnectStatus:N,ExpireDays:q,ExpireProgress:Z,AddressListgDialog:ee},emits:["on-success","selection-change","sort-change","on-refresh-row"],props:{},computed:{},data(){return{currentRow:null,dialogVisible:!1,dialogDetailVisible:!1,AddressListgDialogVisible:!1}},methods:{handleEditRow(n){this.currentRow=n,this.dialogVisible=!0},async handleDeleteClick(n){let e={id:n.id};const t=await this.$http.deleteDomainById(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleStatusChange(n){let e={id:n.id};const t=await this.$Http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleMonitorStatusChange(n,e){let t={domain_id:n.id,is_monitor:e};const u=await this.$http.updateDomainExpireMonitorById(t);u.code==0?this.$msg.success("\u64CD\u4F5C\u6210\u529F"):this.$msg.error(u.msg)},async handleUpdateRowDomainInfo(n){let e=this.$loading({lock:!0,text:"\u66F4\u65B0\u4E2D"}),t={id:n.id};(await this.$http.updateDomainRowInfoById(t)).code==0&&(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")),e.close()},handleUpdateSuccess(){this.$emit("on-success")},handleDetailSuccess(){},handleShowDetail(n){this.currentRow=n,this.dialogDetailVisible=!0},handleShowAddressListgDialog(n){this.currentRow=n,this.AddressListgDialogVisible=!0},async handleAutoUpdateStatusChange(n,e){let t={domain_id:n.id,field:"auto_update",value:e};const u=await this.$http.updateDomainFieldById(t);u.code==0?this.$msg.success("\u64CD\u4F5C\u6210\u529F"):this.$msg.error(u.msg)},handleRefreshRow(n){this.$emit("on-refresh-row",n)}},created(){}},Ve={class:"inline-flex items-center"},Re=m("span",{class:"mr-[2px]"},"\u8BC1\u4E66\u5929\u6570",-1),Ie={key:0,class:"color--danger"},Oe={key:2};function Ue(n,e,t,u,l,s){const c=i("el-table-column"),d=i("el-link"),h=i("ExpireDays"),x=i("Warning"),b=i("el-icon"),k=i("el-tooltip"),v=i("ExpireProgress"),S=i("ConnectStatus"),V=i("el-switch"),R=i("Refresh"),O=i("Edit"),g=i("Delete"),U=i("el-popconfirm"),F=i("el-table"),B=i("DataFormDialog"),T=i("DataDetailDialog"),$=i("AddressListgDialog");return _(),D("div",null,[o(F,Q({stripe:"",border:""},n.$attrs,{onSortChange:e[0]||(e[0]=r=>n.$emit("sort-change",r)),onSelectionChange:e[1]||(e[1]=r=>n.$emit("selection-change",r))}),{default:a(()=>[o(c,{type:"selection","header-align":"center",align:"center",width:"40"}),o(c,{label:"\u57DF\u540D","header-align":"center",align:"center",width:"250","show-overflow-tooltip":"",prop:"domain"},{default:a(r=>[o(d,{underline:!1,onClick:p=>s.handleShowDetail(r.row)},{default:a(()=>[w(f(r.row.domain),1)]),_:2},1032,["onClick"])]),_:1}),o(c,{label:"\u7AEF\u53E3","header-align":"center",align:"center",width:"60",sortable:"custom",prop:"port"},{default:a(r=>[m("span",null,f(r.row.port||"-"),1)]),_:1}),o(c,{label:"\u57DF\u540D\u5929\u6570","header-align":"center",align:"center",width:"80",prop:"domain_expire_days"},{default:a(r=>[o(h,{value:r.row.domain_expire_days},null,8,["value"])]),_:1}),o(c,{label:"\u8BC1\u4E66\u5929\u6570","header-align":"center",align:"center",width:"110",sortable:"custom",prop:"expire_days"},{header:a(()=>[o(k,{effect:"dark",content:"\u5982\u6709\u591A\u4E2A\u4E3B\u673AIP\u5730\u5740\uFF0C\u6B64\u5904\u4EC5\u663E\u793A\u5230\u671F\u65F6\u95F4\u6700\u77ED\u7684\u8BC1\u4E66",placement:"top-start","show-after":800},{default:a(()=>[m("div",Ve,[Re,o(b,null,{default:a(()=>[o(x)]),_:1})])]),_:1})]),default:a(r=>[o(v,{startTime:r.row.start_time,endTime:r.row.expire_time},null,8,["startTime","endTime"])]),_:1}),o(c,{label:"\u4E3B\u673A\u6570\u91CF","header-align":"center",align:"center",width:"80",prop:"address_count"},{default:a(r=>[r.row.is_dynamic_host?(_(),D("span",Ie,"*")):I("",!0),r.row.address_count&&r.row.address_count>0?(_(),y(d,{key:1,underline:!1,onClick:p=>s.handleShowAddressListgDialog(r.row)},{default:a(()=>[w(f(r.row.address_count),1)]),_:2},1032,["onClick"])):(_(),D("span",Oe,"-"))]),_:1}),o(c,{label:"\u72B6\u6001","header-align":"center",align:"center",width:"60",sortable:"custom",prop:"connect_status"},{default:a(r=>[o(S,{value:r.row.connect_status,onOnClick:p=>s.handleShowAddressListgDialog(r.row)},null,8,["value","onOnClick"])]),_:1}),o(c,{label:"\u5206\u7EC4","header-align":"center",align:"center",width:"100",sortable:"custom",prop:"group_name"},{default:a(r=>[m("span",null,f(r.row.group_name||"-"),1)]),_:1}),o(c,{label:"\u5907\u6CE8","header-align":"center",align:"left",prop:"check_time","show-overflow-tooltip":""},{default:a(r=>[m("span",null,f(r.row.alias||"-"),1)]),_:1}),o(c,{label:"\u66F4\u65B0\u65F6\u95F4","header-align":"center",align:"center",width:"90",prop:"update_time",sortable:"custom","show-overflow-tooltip":""},{default:a(r=>[m("span",null,f(r.row.update_time_label||"-"),1)]),_:1}),o(c,{label:"\u81EA\u52A8\u66F4\u65B0",width:"90","header-align":"center",align:"center",sortable:"custom",prop:"auto_update"},{default:a(r=>[o(V,{modelValue:r.row.auto_update,"onUpdate:modelValue":p=>r.row.auto_update=p,onChange:p=>s.handleAutoUpdateStatusChange(r.row,p)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(c,{label:"\u76D1\u6D4B",width:"60","header-align":"center",align:"center",sortable:"custom",prop:"is_monitor"},{default:a(r=>[o(V,{modelValue:r.row.is_monitor,"onUpdate:modelValue":p=>r.row.is_monitor=p,onChange:p=>s.handleMonitorStatusChange(r.row,p)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(c,{label:"\u64CD\u4F5C",width:"100","header-align":"center",align:"center"},{default:a(r=>[o(d,{underline:!1,type:"primary",class:"mr-sm",onClick:p=>s.handleUpdateRowDomainInfo(r.row)},{default:a(()=>[o(b,null,{default:a(()=>[o(R)]),_:1})]),_:2},1032,["onClick"]),o(d,{underline:!1,type:"primary",class:"mr-sm",onClick:p=>s.handleEditRow(r.row)},{default:a(()=>[o(b,null,{default:a(()=>[o(O)]),_:1})]),_:2},1032,["onClick"]),o(U,{title:"\u786E\u5B9A\u5220\u9664\uFF1F",onConfirm:p=>s.handleDeleteClick(r.row)},{reference:a(()=>[o(d,{underline:!1,type:"danger"},{default:a(()=>[o(b,null,{default:a(()=>[o(g)]),_:1})]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},16),o(B,{visible:l.dialogVisible,"onUpdate:visible":e[2]||(e[2]=r=>l.dialogVisible=r),row:l.currentRow,onOnSuccess:e[3]||(e[3]=r=>s.handleRefreshRow(l.currentRow))},null,8,["visible","row"]),o(T,{row:l.currentRow,visible:l.dialogDetailVisible,"onUpdate:visible":e[4]||(e[4]=r=>l.dialogDetailVisible=r),onOnSuccess:e[5]||(e[5]=r=>s.handleRefreshRow(l.currentRow))},null,8,["row","visible"]),l.currentRow?(_(),y($,{key:0,domainId:l.currentRow.id,visible:l.AddressListgDialogVisible,"onUpdate:visible":e[6]||(e[6]=r=>l.AddressListgDialogVisible=r),onOnClose:e[7]||(e[7]=r=>s.handleRefreshRow(l.currentRow))},null,8,["domainId","visible"])):I("",!0)])}const Fe=C(Se,[["render",Ue]]),Be={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u66F4\u65B0":"\u5168\u90E8\u66F4\u65B0"}},methods:{async updateAllDomainCertInfoOfUser(){this.updateTimer=!0,await this.$http.updateAllDomainCertInfoOfUser()}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function Te(n,e,t,u,l,s){const c=i("Refresh"),d=i("el-icon"),h=i("el-link");return _(),y(h,{underline:!1,type:"primary",onClick:s.updateAllDomainCertInfoOfUser,disabled:s.disableUpdateButton},{default:a(()=>[o(d,null,{default:a(()=>[o(c)]),_:1}),w(f(s.updateText),1)]),_:1},8,["onClick","disabled"])}const $e=C(Be,[["render",Te]]),Ee={name:"updateDomainInfo",props:{},components:{},data(){return{updateTimer:null}},computed:{disableUpdateButton(){return this.updateTimer!=null},updateText(){return this.disableUpdateButton?"\u6B63\u5728\u68C0\u67E5":"\u8BC1\u4E66\u68C0\u67E5"}},methods:{async handleNotifyByEventId(){const n=await this.$http.handleNotifyByEventId({event_id:W.SSL_CERT_EXPIRE});n.ok&&this.$msg.success(`\u6210\u529F\u6E20\u9053\uFF1A${n.data.success}`)}},beforeUnmount(){clearInterval(this.updateTimer),this.updateTimer=null},created(){}};function Ae(n,e,t,u,l,s){const c=i("Position"),d=i("el-icon"),h=i("el-link");return _(),y(h,{underline:!1,type:"primary",onClick:s.handleNotifyByEventId,disabled:s.disableUpdateButton},{default:a(()=>[o(d,null,{default:a(()=>[o(c)]),_:1}),w(f(s.updateText),1)]),_:1},8,["onClick","disabled"])}const ze=C(Ee,[["render",Ae]]),Pe={name:"ConditionFilter",props:{},components:{ConditionFilterGroup:te},data(){return{loading:!0,options:[{title:"\u8BC1\u4E66\u72B6\u6001",maxCount:1,field:"expire_days",selected:[],options:[{label:"\u5DF2\u8FC7\u671F",value:[null,3]},{label:"3\u5929\u5185\u8FC7\u671F",value:[0,3]},{label:"7\u5929\u5185\u8FC7\u671F",value:[0,7]},{label:"30\u5929\u5185\u8FC7\u671F",value:[0,30]}]},{title:"\u57DF\u540D\u5206\u7EC4",field:"group_ids",hidden:!0,selected:[],options:[]}]}},computed:{...L(E,{groupOptions:"getGroupOptions"})},methods:{async getData(){const n=await this.$http.getDomainGroupFilter();n.ok&&this.options.forEach(e=>{e.field=="group_ids"&&(n.data.list&&n.data.list.length>0?(e.options=n.data.list.map(t=>{let u=t.name;return t.cert_count>0&&(u=`${t.name} ${t.cert_count}`),{...t,value:t.id,label:u}}),e.hidden=!1):e.hidden=!0)}),this.loading=!1,console.log(this.options)},handleChange(n){this.$emit("on-change",this.options)}},created(){this.getData()}},Ge={class:""};function Le(n,e,t,u,l,s){const c=i("ConditionFilterGroup"),d=A("loading");return z((_(),D("div",Ge,[o(c,{options:l.options,onOnChange:s.handleChange},null,8,["options","onOnChange"])])),[[d,l.loading]])}const Ne=C(Pe,[["render",Le]]),qe={name:"domain-list",props:{},components:{DataFormDialog:j,DataTable:Fe,SelectGroup:G,UpdateDomainInfo:$e,CheckDomainInfo:ze,ConditionFilter:Ne},data(){return{dataApi:P,list:[],total:0,page:1,size:20,keyword:"",group_id:"",pageSizeCachekey:"pageSize",loading:!0,dialogVisible:!1,export_to_file_url:K(P.exportDomainToFile),order_type:"ascending",order_prop:"expire_days",hasInitData:!1,ConditionFilterParams:[],selectedRows:[]}},computed:{...L(E,{groupOptions:"getGroupOptions"}),showBatchDeleteButton(){return!!(this.selectedRows&&this.selectedRows.length>0)}},methods:{...X(E,{updateGroupOptions:"updateGroupOptions"}),resetData(){this.page=1,this.getData()},refreshData(){this.getData()},async getData(){this.loading=!0;let n={page:this.page,size:this.size,group_id:this.group_id,keyword:this.keyword.trim(),order_type:this.order_type,order_prop:this.order_prop};for(let t of this.ConditionFilterParams)t.selected&&t.selected.length>0&&(t.maxCount==1?n[t.field]=t.selected[0]:n[t.field]=t.selected);const e=await this.$http.getDomainList(n);e.code==0?(this.list=e.data.list.map(t=>this.preHandleRow(t)),this.total=e.data.total):this.$msg.error(e.msg),this.loading=!1},preHandleRow(n){return n._uuid=M(),n.group_id&&(n.group_name=this.getGroupName(n.group_id)),n},getGroupName(n){let e=this.groupOptions.find(t=>t.value==n);if(e)return e.name},async handleHttpRequest(n){let e=this.$loading({fullscreen:!0}),t=new FormData;t.append("file",n.file),(await this.$http.importDomainFromFile(t)).code==0&&(this.$msg.success("\u4E0A\u4F20\u6210\u529F\uFF0C\u540E\u53F0\u5BFC\u5165\u4E2D"),this.resetData()),e.close()},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},async handleExportToFile(){const n=await this.$http.exportDomainFile();n.ok&&oe.saveAs(n.data.url,n.data.name)},handleSearch(){this.resetData()},handleSizeChange(n){localStorage.setItem(this.pageSizeCachekey,n),this.resetData()},loadPageSize(){let n=localStorage.getItem(this.pageSizeCachekey);n&&(this.size=parseInt(n))},handleExceed(n){this.$refs.upload.clearFiles();const e=n[0];e.uid=ne(),this.handleHttpRequest({file:e})},handleSortChange({column:n,prop:e,order:t}){console.log(n,e,t),this.order_prop="",this.order_type="",t&&(this.order_type=t,this.order_prop=e),this.resetData()},async initData(){this.loadPageSize(),await this.updateGroupOptions(),this.hasInitData=!0,this.getData()},handleSelectionChange(n){this.selectedRows=n},handleConditionFilterChange(n){console.log(n),this.ConditionFilterParams=n,this.resetData()},async handleBatchDeleteConfirm(){let n=this.$loading({fullscreen:!0}),e={ids:this.selectedRows.map(t=>t.id)};try{const t=await this.$http.deleteDomainByIds(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData()):this.$msg.error(t.msg)}catch(t){console.log(t)}finally{this.$nextTick(()=>{n.close()})}},async handleRefreshRow(n){let e={id:n.id};const t=await this.$http.getDomainById(e);if(t.ok){let u=this.list.findIndex(l=>l.id==n.id);this.list.splice(u,1,this.preHandleRow(t.data)),console.log(this.list)}}},created(){this.keyword=this.$route.query.keyword||this.keyword,this.initData()}},je={class:"app-container"},He={class:"flex",style:{"justify-content":"space-between"}},We={class:"flex mt-sm",style:{"align-items":"center"}},Ke={style:{"font-size":"14px",color:"#333333"}},Me={class:"flex",style:{"margin-left":"auto"}},Qe=m("div",{style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},null,-1);function Xe(n,e,t,u,l,s){const c=i("Plus"),d=i("el-icon"),h=i("el-button"),x=i("Search"),b=i("el-input"),k=i("ConditionFilter"),v=i("Delete"),S=i("el-link"),V=i("el-popconfirm"),R=i("UpdateDomainInfo"),O=i("CheckDomainInfo"),g=i("Upload"),U=i("el-upload"),F=i("Download"),B=i("DataTable"),T=i("el-pagination"),$=i("DataFormDialog"),r=A("loading");return _(),D("div",je,[m("div",He,[o(h,{type:"primary",onClick:s.handleAddRow},{default:a(()=>[o(d,null,{default:a(()=>[o(c)]),_:1}),w("\u6DFB\u52A0")]),_:1},8,["onClick"]),o(b,{class:"ml-sm",style:{width:"260px"},modelValue:l.keyword,"onUpdate:modelValue":e[0]||(e[0]=p=>l.keyword=p),placeholder:"\u641C\u7D22\u57DF\u540D",clearable:"",onKeypress:J(s.handleSearch,["enter"]),onClear:s.handleSearch},{append:a(()=>[o(h,{onClick:s.handleSearch},{default:a(()=>[o(d,null,{default:a(()=>[o(x)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue","onKeypress","onClear"])]),l.hasInitData?(_(),y(k,{key:0,class:"mt-md",onOnChange:s.handleConditionFilterChange},null,8,["onOnChange"])):I("",!0),m("div",We,[m("div",Ke,"\u5171\u8BA1 "+f(l.total)+" \u6761\u6570\u636E",1),m("div",Me,[s.showBatchDeleteButton?(_(),y(V,{key:0,title:"\u786E\u5B9A\u5220\u9664\u9009\u4E2D\uFF1F",onConfirm:s.handleBatchDeleteConfirm},{reference:a(()=>[o(S,{underline:!1,type:"danger",class:"mr-sm"},{default:a(()=>[o(d,null,{default:a(()=>[o(v)]),_:1}),w("\u6279\u91CF\u5220\u9664")]),_:1})]),_:1},8,["onConfirm"])):I("",!0),o(R,{onOnSuccess:s.resetData},null,8,["onOnSuccess"]),o(O,{class:"ml-sm",onOnSuccess:s.resetData},null,8,["onOnSuccess"]),o(S,{underline:!1,type:"primary",class:"ml-sm",style:{position:"relative"}},{default:a(()=>[o(d,null,{default:a(()=>[o(g)]),_:1}),w("\u5BFC\u5165 "),o(U,{ref:"upload",action:"action",accept:".txt",limit:1,"on-exceed":s.handleExceed,"show-file-list":!1,"http-request":s.handleHttpRequest},{default:a(()=>[Qe]),_:1},8,["on-exceed","http-request"])]),_:1}),o(S,{underline:!1,type:"primary",class:"ml-sm",onClick:s.handleExportToFile},{default:a(()=>[o(d,null,{default:a(()=>[o(F)]),_:1}),w("\u5BFC\u51FA")]),_:1},8,["onClick"])])]),z(o(B,{class:"mt-sm",data:l.list,onOnSuccess:s.resetData,onOnRefreshRow:s.handleRefreshRow,onSortChange:s.handleSortChange,onSelectionChange:s.handleSelectionChange},null,8,["data","onOnSuccess","onOnRefreshRow","onSortChange","onSelectionChange"]),[[r,l.loading]]),o(T,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:l.total,"page-size":l.size,"onUpdate:pageSize":e[1]||(e[1]=p=>l.size=p),"current-page":l.page,"onUpdate:currentPage":e[2]||(e[2]=p=>l.page=p),onCurrentChange:s.getData,onSizeChange:s.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"]),o($,{visible:l.dialogVisible,"onUpdate:visible":e[3]||(e[3]=p=>l.dialogVisible=p),onOnSuccess:s.handleAddSuccess},null,8,["visible","onOnSuccess"])])}const it=C(qe,[["render",Xe]]);export{it as default};
